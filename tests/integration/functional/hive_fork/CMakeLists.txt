MACRO( ADD_SQL_FUNCTIONAL_TESTS sql_test_path)
    STRING( REGEX MATCH "^(([^\\/]*)\\/)?(.*)\\.[^.]*$" dummy ${sql_test_path} ) # remove sql extension
    SET( test_name ${CMAKE_MATCH_3})
    IF( CMAKE_MATCH_2 )
        SET( test_name ${CMAKE_MATCH_2}.${test_name} )
    ENDIF()
    SET( test_target test.functional.hive_fork.${test_name} )
    SET( sources_under_tests_path ${CMAKE_SOURCE_DIR}/src/sql_fork_extension )
    ADD_TEST( NAME ${test_target}
            COMMAND test.sh ${sources_under_tests_path} ${sql_test_path}
            WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    )
    MESSAGE( STATUS "Added functional tests '${test_target}'" )
ENDMACRO()

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/schema_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/register_table_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/register_table_edit_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/register_table_edit_negative_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/register_table_edit_negative_rowid_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/register_table_drop_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/detach_table_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/attach_table_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/detach_negative_unregistered_table_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/detach_negative_not_empty_shadow_table_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/detach_all_tables_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/detach_all_negative_tables_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/detach_constraint_fk_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/attach_negative_unregistered_table_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/attach_all_tables_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/attach_all_negative_tables_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/drop_registered_table_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/register_table_no_context_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/register_table_public_schema_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/create_context_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/create_context_negative.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/context_next_block_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/trigger_on_insert_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/trigger_on_delete_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/trigger_on_update_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/trigger_on_truncate_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/trigger_on_insert_update_delete_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/trigger_on_multi_rows_insert_update_delete_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/trigger_3_tables_on_insert_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/trigger_3_tables_on_update_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/trigger_3_tables_on_delete_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/trigger_3_tables_on_truncate_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_insert_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_delete_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_update_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_truncate_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_insert_delete_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_insert_next_delete_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_update_delete_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_update_next_delete_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_update_some_rows_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_delete_insert_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_delete_next_insert_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_3_tables_insert_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_3_tables_delete_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_3_tables_update_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_3_tables_truncate_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_2_tables_schemas_insert_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_2_contexts_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_to_block_num_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_constraint_fk_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_constraint_unique_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_constraint_pk_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_complex_type_update_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_complex_type_insert_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/back_from_fork_complex_type_delete_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/set_irreversible_block_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/set_irreversible_block_negative_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( context_rewind/performance_insert_rows_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/performance_back_from_insert_rows_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/performance_delete_rows_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/performance_back_from_delete_rows_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/performance_update_rows_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/performance_back_from_update_rows_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/performance_truncate_rows_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/performance_back_from_truncate_rows_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/performance_insert_rows_one_by_one_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/performance_delete_rows_one_by_one_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( context_rewind/performance_update_rows_one_by_one_test.sql )


ADD_SQL_FUNCTIONAL_TESTS( hived_api/schema_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/back_from_fork_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/push_block_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/set_irreversible_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/copy_blocks_to_irreversible.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/copy_transactions_to_irreversible_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/copy_operations_to_irreversible_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/copy_signatures_to_irreversible_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/remove_obsolete_blocks_with_set_irreversible.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/remove_obsolete_blocks_with_set_irreversible_3_contexts.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/remove_obsolete_blocks_with_set_irreversible_no_contexts.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/end_massive_sync_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( hived_api/set_irreversible_cleaning_events_test.sql )

ADD_SQL_FUNCTIONAL_TESTS( app_api/create_context_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/context_blocks_view_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/context_blocks_view_nonforking_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/context_transactions_view_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/context_transactions_view_non_forking_app_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/context_signatures_view_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/context_signatures_view_non_forking_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/context_operations_view_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/context_operations_view_non_forking_test.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_next_block_process_new_block_event.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_next_block_negative.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_next_block_process_new_block_event_2_contexts.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_next_block_process_BFF_event.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_next_block_process_BFF_event_2_contexts.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_next_block_process_SET_IRREVERSIBLE_event.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_next_block_process_SET_IRREVERSIBLE_event_2_contexts.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_context_attach.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_context_attach_negative.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_context_detach.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_next_block_process_MASSIVE_SYNC_event.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_next_block_non_forking_app.sql )
ADD_SQL_FUNCTIONAL_TESTS( app_api/app_context_exists.sql )

ADD_SQL_FUNCTIONAL_TESTS( scenarios/massive_sync_live_blocks_and_fork.sql )
ADD_SQL_FUNCTIONAL_TESTS( scenarios/massive_sync_live_blocks_and_fork_non_forking_app.sql )